@page
@model project_pharmacie.Areas.Staff.Pages.Sales.CreateModel
@{
    ViewData["Title"] = "Nouvelle Vente";
}

<div class="mx-auto max-w-3xl px-4 py-6">
    <!-- Header -->
    <div class="mb-6 flex items-start justify-between gap-3">
        <div>
            <h1 class="text-2xl font-semibold tracking-tight">Ajouter une vente</h1>
            <p class="text-sm text-zinc-500">Vente réelle (EF Core) : stock décrémenté + total serveur.</p>
        </div>

        <a asp-area="Staff" asp-page="/Sales/History"
           class="rounded-xl border bg-white px-4 py-2 text-sm hover:bg-zinc-50">
            ← Retour
        </a>
    </div>

    <partial name="/Areas/Admin/Pages/Shared/_Flash.cshtml" />

    @if (!string.IsNullOrWhiteSpace(Model.ErrorMessage))
    {
        <div class="mb-4 rounded-2xl border border-red-200 bg-red-50 p-4 text-sm text-red-800">
            @Model.ErrorMessage
        </div>
    }

    <div class="rounded-2xl border bg-white p-5">
        <form method="post" class="space-y-5">

            <input type="hidden" asp-for="CustomerHint" />

            <div>
                <label class="mb-1 block text-sm font-medium">Client</label>
                <select asp-for="NewSale.ClientId"
                        class="w-full rounded-xl border px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-zinc-200">
                    <option value="">-- Choisir un client --</option>
                    @foreach (var c in Model.Clients)
                    {
                        <option value="@c.Id">@c.Name (pts: @c.Points)</option>
                    }
                </select>
                <span asp-validation-for="NewSale.ClientId" class="text-sm text-red-600"></span>
            </div>

            <div>
                <label class="mb-1 block text-sm font-medium">Produit</label>
                <select asp-for="NewSale.ProductId"
                        class="w-full rounded-xl border px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-zinc-200">
                    <option value="">-- Choisir un produit --</option>
                    @foreach (var p in Model.Products)
                    {
                        <option value="@p.Id">@p.Name (stock: @p.Stock) — @p.Prix.ToString("N2")</option>
                    }
                </select>
                <span asp-validation-for="NewSale.ProductId" class="text-sm text-red-600"></span>
            </div>

            <div class="grid gap-4 sm:grid-cols-2">
                <div>
                    <label class="mb-1 block text-sm font-medium">Quantité</label>
                    <input asp-for="NewSale.Quantity" type="number" min="1"
                           class="w-full rounded-xl border px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-zinc-200" />
                    <span asp-validation-for="NewSale.Quantity" class="text-sm text-red-600"></span>
                </div>

                <div class="flex items-end">
                    <label class="inline-flex items-center gap-2 text-sm">
                        <input asp-for="NewSale.CreateInvoice" type="checkbox"
                               class="rounded border" />
                        Créer une facture automatiquement
                    </label>
                </div>
            </div>

            <div class="flex flex-col gap-2 sm:flex-row sm:justify-end">
                <a asp-area="Staff" asp-page="/Sales/History"
                   class="rounded-xl px-4 py-2 text-sm text-zinc-700 hover:bg-zinc-50">
                    Annuler
                </a>
                <button class="rounded-xl bg-zinc-900 px-4 py-2 text-sm font-medium text-white hover:bg-zinc-800">
                    Enregistrer
                </button>
            </div>

        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}