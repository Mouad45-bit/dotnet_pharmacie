@page
@model project_pharmacie.Areas.Staff.Pages.Dashboard.IndexModel
@{
    ViewData["Title"] = "Dashboard";
}

<div class="mx-auto max-w-6xl px-4 py-6">

    <!-- Header (même style que Clients/Index) -->
    <div class="mb-2 flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
        <div>
            <h1 class="text-2xl font-semibold tracking-tight">
                Dashboard
            </h1>
        </div>

        <div class="flex gap-2">
            <a asp-area="Staff" asp-page="/Orders/Create"
               class="rounded-xl bg-zinc-900 px-4 py-2 text-sm font-medium text-white hover:bg-zinc-800">
                Passer commande
            </a>
        </div>
    </div>

    <p class="mb-6 text-sm text-zinc-500">
        Aperçu rapide du stock.
    </p>

    <partial name="/Areas/Admin/Pages/Shared/_Flash.cshtml" />

    <!-- KPIs (cards zinc, sans shadow) -->
    <div class="mb-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
        <div class="rounded-2xl border bg-white p-4">
            <p class="text-sm text-zinc-500">Total produits</p>
            <p class="mt-2 text-2xl font-semibold text-zinc-900">@Model.KpiTotalProducts</p>
        </div>

        <div class="rounded-2xl border bg-white p-4">
            <p class="text-sm text-zinc-500">Produits en alerte</p>
            <p class="mt-2 text-2xl font-semibold text-zinc-900">@Model.KpiLowStockCount</p>
            <p class="mt-1 text-xs text-zinc-500">stock ≤ seuil</p>
        </div>

        <div class="rounded-2xl border bg-white p-4">
            <p class="text-sm text-zinc-500">Unités en stock</p>
            <p class="mt-2 text-2xl font-semibold text-zinc-900">@Model.KpiTotalUnits</p>
        </div>

        <div class="rounded-2xl border bg-white p-4">
            <p class="text-sm text-zinc-500">Valeur stock (MAD)</p>
            <p class="mt-2 text-2xl font-semibold text-zinc-900">@Model.KpiStockValueMad.ToString("N2")</p>
        </div>
    </div>

    <!-- Table produits en alerte (même style que Clients/Index) -->
    <div class="overflow-hidden rounded-2xl border bg-white">
        <div class="flex flex-col gap-3 border-b bg-white p-4 sm:flex-row sm:items-end sm:justify-between">
            <div>
                <h2 class="text-base font-semibold text-zinc-900">Produits en rupture / alerte</h2>
                <p class="text-sm text-zinc-500">Liste des produits à surveiller.</p>
            </div>

            <a asp-area="Staff" asp-page="/Products/Index"
               class="rounded-xl border bg-white px-4 py-2 text-sm hover:bg-zinc-50">
                Voir tous les produits
            </a>
        </div>

        <table class="min-w-full text-left text-sm">
            <thead class="bg-zinc-50 text-zinc-600">
                <tr>
                    <th class="px-4 py-3 font-medium">Produit</th>
                    <th class="px-4 py-3 font-medium">Catégorie</th>
                    <th class="px-4 py-3 font-medium">Stock</th>
                    <th class="px-4 py-3 font-medium">Seuil</th>
                    <th class="px-4 py-3 font-medium text-right">Action</th>
                </tr>
            </thead>

            <tbody class="divide-y">
                @if (Model.LowStockProducts == null || Model.LowStockProducts.Count == 0)
                {
                    <tr>
                        <td colspan="5" class="px-4 py-10 text-center">
                            <p class="text-base font-semibold">Aucun produit en alerte</p>
                            <p class="mt-1 text-sm text-zinc-500">Le stock est stable pour le moment.</p>
                        </td>
                    </tr>
                }
                else
                {
                    foreach (var p in Model.LowStockProducts)
                    {
                        var isOut = p.Stock == 0;
                        var label = isOut ? "Rupture" : "Alerte";

                        <tr class="hover:bg-zinc-50/50">
                            <td class="px-4 py-3">
                                <span class="font-medium text-zinc-900">@p.Name</span>
                            </td>
                            <td class="px-4 py-3 text-zinc-700">@p.Category</td>
                            <td class="px-4 py-3">
                                @if (isOut)
                                {
                                    <span class="rounded-full bg-red-50 px-2 py-1 text-xs font-medium text-red-700">
                                        @label • @p.Stock
                                    </span>
                                }
                                else
                                {
                                    <span class="rounded-full bg-amber-50 px-2 py-1 text-xs font-medium text-amber-700">
                                        @label • @p.Stock
                                    </span>
                                }
                            </td>
                            <td class="px-4 py-3 text-zinc-700">@p.ReorderLevel</td>
                            <td class="px-4 py-3 text-right">
                                <a asp-area="Staff" asp-page="/Orders/Create" asp-route-supplierHint="@p.SupplierHint"
                                   class="rounded-xl border bg-white px-3 py-1.5 text-sm hover:bg-zinc-50">
                                    Commander
                                </a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

</div>