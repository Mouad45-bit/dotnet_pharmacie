@page
@model project_pharmacie.Areas.Staff.Pages.Orders.HistoryModel
@{
    ViewData["Title"] = "Historique commandes";
}

<div class="mx-auto max-w-6xl px-4 py-6">

    <!-- Header (même style que Clients/Index) -->
    <div class="mb-2 flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
        <div>
            <h1 class="text-2xl font-semibold tracking-tight">
                Historique des commandes
            </h1>
        </div>

        <div class="flex gap-2">
            <a asp-area="Staff" asp-page="/Dashboard/Index"
               class="rounded-xl border bg-white px-4 py-2 text-sm hover:bg-zinc-50">
                ← Dashboard
            </a>

            <a asp-area="Staff" asp-page="/Orders/Create"
               class="inline-flex items-center justify-center rounded-xl bg-zinc-900 px-4 py-2 text-sm font-medium text-white hover:bg-zinc-800">
                + Nouvelle commande
            </a>
        </div>
    </div>

    <p class="mb-6 text-sm text-zinc-500">
        Liste des commandes (données mock pour l’instant).
        @if (!string.IsNullOrWhiteSpace(Model.Query))
        {
            <span>Recherche : “@Model.Query”.</span>
        }
        @if (!string.IsNullOrWhiteSpace(Model.StatusFilter))
        {
            <span>Statut : @Model.StatusFilter.</span>
        }
    </p>

    <partial name="/Areas/Admin/Pages/Shared/_Flash.cshtml" />

    @if (TempData["Toast.Success"] is string toast && !string.IsNullOrWhiteSpace(toast))
    {
        <div class="mb-4 rounded-2xl border border-emerald-200 bg-emerald-50 p-4 text-sm text-emerald-800">
            @toast
        </div>
    }

    <!-- Barre de recherche -->
    <div class="mb-4 rounded-2xl border bg-white p-4">
        <form method="get" class="w-full flex flex-col gap-3 sm:flex-row sm:items-end">

            <!-- Groupe qui prend toute la largeur disponible -->
            <div class="flex-1 flex flex-col gap-3 sm:flex-row">
                <!-- Recherche : 4 parts -->
                <div class="sm:flex-[4_1_0%]">
                    <label class="mb-1 block text-xs font-medium text-zinc-600">Recherche</label>
                    <input name="q" value="@Model.Query"
                           placeholder="Fournisseur ou produit..."
                           class="w-full rounded-xl border px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-zinc-200" />
                </div>

                <!-- Statut : 1 part -->
                <div class="sm:flex-[1_1_0%] min-w-[180px]">
                    <label class="mb-1 block text-xs font-medium text-zinc-600">Statut</label>
                    <select name="status"
                            class="w-full rounded-xl border px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-zinc-200">
                        <option value="" selected="@(string.IsNullOrWhiteSpace(Model.StatusFilter))">Tous</option>
                        <option value="PENDING" selected="@(Model.StatusFilter == "PENDING")">En attente</option>
                        <option value="DELIVERED" selected="@(Model.StatusFilter == "DELIVERED")">Livrée</option>
                        <option value="CANCELLED" selected="@(Model.StatusFilter == "CANCELLED")">Annulée</option>
                    </select>
                </div>
            </div>

            <!-- Boutons : largeur fixe -->
            <div class="flex gap-2 sm:pt-0 shrink-0">
                <button type="submit"
                        class="rounded-xl bg-zinc-900 px-4 py-2 text-sm font-medium text-white hover:bg-zinc-800 whitespace-nowrap">
                    Rechercher
                </button>

                <a asp-area="Staff" asp-page="/Orders/History"
                   class="rounded-xl border bg-white px-4 py-2 text-sm hover:bg-zinc-50 whitespace-nowrap">
                    Réinitialiser
                </a>
            </div>

        </form>
    </div>

    @if (Model.Rows == null || Model.Rows.Count == 0)
    {
        <!-- Empty state (même style que Clients/Index) -->
        <div class="rounded-2xl border bg-white p-10 text-center">
            <p class="text-base font-semibold">Aucune commande trouvée</p>
            <p class="mt-1 text-sm text-zinc-500">
                Essaie une autre recherche, change le statut, ou crée une nouvelle commande.
            </p>
            <div class="mt-4">
                <a asp-area="Staff" asp-page="/Orders/Create"
                   class="inline-flex items-center justify-center rounded-xl bg-zinc-900 px-4 py-2 text-sm font-medium text-white hover:bg-zinc-800">
                    + Nouvelle commande
                </a>
            </div>
        </div>
    }
    else
    {
        <div class="overflow-hidden rounded-2xl border bg-white">
            <table class="min-w-full text-left text-sm">
                <thead class="bg-zinc-50 text-zinc-600">
                    <tr>
                        <th class="px-4 py-3 font-medium">Date</th>
                        <th class="px-4 py-3 font-medium">Fournisseur</th>
                        <th class="px-4 py-3 font-medium">Produit</th>
                        <th class="px-4 py-3 font-medium">Qté</th>
                        <th class="px-4 py-3 font-medium">Statut</th>
                        <th class="px-4 py-3 font-medium text-right">Actions</th>
                    </tr>
                </thead>

                <tbody class="divide-y">
                    @foreach (var o in Model.Rows)
                    {
                        var badge = Model.GetStatusBadge(o.Status);

                        <tr class="hover:bg-zinc-50/50">
                            <td class="px-4 py-3 text-zinc-700">@o.CreatedAt.ToString("yyyy-MM-dd HH:mm")</td>
                            <td class="px-4 py-3">
                                <span class="font-medium text-zinc-900">@o.SupplierName</span>
                            </td>
                            <td class="px-4 py-3 text-zinc-700">@o.ProductName</td>
                            <td class="px-4 py-3 text-zinc-700">@o.Quantity</td>
                            <td class="px-4 py-3">
                                <span class="rounded-full px-2 py-1 text-xs font-medium @badge.cls">
                                    @badge.label
                                </span>
                            </td>
                            <td class="px-4 py-3 text-right">
                                <div class="flex justify-end gap-2">
                                    <a asp-area="Staff" asp-page="/Orders/Create" asp-route-supplierId="@o.SupplierId"
                                       class="rounded-xl border bg-white px-3 py-1.5 text-sm hover:bg-zinc-50">
                                        Recommander
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>

            </table>
        </div>
    }

</div>